# Frontend_История операций по картам
**Цель:** документ описывает раздел «История операций по картам» и дополнительные формы, входящие в раздел.
## История изменений

|**Автор**|**Дата изменения**|**Версия изменений**|**Описание**|**Задача**|
| :- | :-: | :-: | :-: | :-: |
|Пасюк Д.А. |21.10.2021 |1.0|Исходная версия документа|TASK-1|
## Ссылка на дизайн

## Общие требования к разделу
Раздел доступен всем клиентам ДБО. 

Раздел открывается после входа клиента в ДБО в раздел «Карты». При этом сразу при нажатии на карту можно получить краткую историю операций, которая содержит только 5 последних. 

Так же под каждой картой должна отображаться кнопка «История операций», при нажатии на которую можно попасть в раздел «История операций», где в свою очередь можно посмотреть операции по одной или нескольким картам. В интерфейсе данного раздела так же есть возможность выставить фильтр по типам операций, категориям, а так же отсортировать по датам, суммам, группировать операции по датам.
## **Макет раздела**

## **Блок “Карты”**
Для отображения раздела Frontend инициирует вызов сервиса GET api/cards/list (без параметров|запрос не параметризован)

В случае если от сервиса получена ошибка или пустой ответ, отображается экран с ошибкой. Текст сообщения «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае если получен успешный ответ, Frontend отображает форму с параметрами:

|**Поле**| **Описание**| |
| :-: | - | - |
|Блок с картами|<p>Содержит экземпляры data/cards[] ответа сервиса GET api/cards/list</p><p>Действия:</p><p>1) Реквизиты</p>|
|Элемент Карта| | |
| |Иконка|<p>Значение data/cards/cardDesign ответа сервиса GET api/cards/list</p><p>Если значение не получено, отображается иконка по-умолчанию</p>|
| |Название карты|<p>Значение data/cards/name</p><p>В поле отображается 100 символов. Если значение больше, то отображается только часть текста и троеточие.</p><p>При наведение на такую строку полный текст должен отображаться во всплывающей подсказке.</p>|
||Платежная система|Значение  data/cards/paySystem|
| |Номер карты|<p>Значение data/cards/maskedNumber</p><p>Отображается в формате \*XXXX, где XXXX - последние 4 цифры значения</p>|
| |Тип карты|<p>Значение data/cards/cardtype</p><p>В случае если получено значение</p><p>·        ‘debit’ отобразить текст «Дебетовая»</p><p>·        ‘credit’ – отобразить текст «Кредитная»</p>|
| |Баланс|<p>Значение data/cards/balance</p><p>По-умолчанию отображается зеленым цветом</p><p>В случае если значение отрицательное - отображается красным цветом</p>|
| |Статус карты|<p>Если получено значение data/cards/status:</p><p>- ‘active’ - отобразить значение “Активна”</p><p>- ‘blocked’- отобразить значение “Заблокирована”</p><p>- ‘inactive’ - отобразить значение “Требует активации”</p>|
||Краткая история операций|<p>Значение data/cards/smallhistory</p><p>В поле отображаются операции за последние 10 дней, но не более 5.</p><p>Если операции не совершались, то выводится сообщение «Операции по карте не совершались»</p>|
Под каждой картой отображаются действия, доступные с картой:

|**Действие**|**Описание**|
| :-: | :-: |
|Реквизиты|tbd|
|Тарифы|tbd|
|Заблокировать|tbd|
|История операций|<p>см. Раздел История операций</p><p>Элемент представлен кнопкой и раскрывающимся списком. При нажатии на список, появляется 5 последних операций по данной карте.</p><p>Заголовок блока меняется в зависимости от раскрытия: “Показать/Скрыть историю операций”</p><p>По нажатию на кнопку появляется раздел «История операций»</p><p>В нем доступен функционал фильтрации по типам операций, категориям, сортировка по дате, сумму и группировка операций по дате</p>|
## История операций
Для отображения раздела Frontend инициирует вызов сервиса GET api/cards/list/{cardId}/history. Параметром в данном случае будет являться cardId, по которому нужно вывести историю операций.
В случае если от сервиса получена ошибка или пустой ответ, отображается экран с ошибкой. Текст сообщения «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае если получен успешный ответ, Frontend отображает форму с параметрами:

|**Поле**| **Описание**| |
| :-: | - | - |
|Блок с историей операций|<p>Содержит экземпляры data/ cards /{cardId}/history ответа сервиса GET api/cards/list/{cardId}/history </p><p></p>|
|Элемент История| |
||Дата и время совершения операции|<p>Значение data/ cards /{cardId} / history / transaction\_date</p><p>В поле отображается дата и время совершения транзакции.</p>|
| |Название операции |<p>Значение data/ cards /{cardId} / history / description</p><p>В поле отображается название операции. </p>|
| |Название мерчанта|<p>Значение data/ cards /{cardId} / history / merch</p><p>В поле отображается название мерчанта.</p>|
| |Сумма операции |<p>Значение data/ cards /{cardId} / history / transaction\_amount</p><p>В поле отображается сумма операции.</p>|
||Валюта операции |<p>Значение data/ cards /{cardId} / history/ transaction\_currency</p><p>В поле отображается значок валюты.</p>|
| |Категория операции|<p>Значение data/ cards /{cardId} / history / mcc</p><p>В поле отображается категория операции согласно справочнику MCC кодов.</p>|
||Иконка операции или мерчанта|<p>Значение data/merch/merchDesign ответа сервиса GET api/merch</p><p>Если значение не получено, отображается иконка по-умолчанию</p>|
Действия, доступные с историей операций:

|**Действие**|**Описание**|
| :-: | :-: |
|Выбрать период для отображения|При нажатии на кнопку появляется возможность выбрать дату начала и окончания периода для отображения.|
|Сортировка отображения операций по дате|Отображается выпадающий список: по убыванию, по возрастанию.|
|Сортировка отображения операций по сумме|Отображается выпадающий список: по убыванию, по возрастанию.|
|Фильтрация по категориям|Появляется окно с выбором категорий в виде списка с возможностью установить флаги на нужных категориях.|