# API_Получение истории операций
## История изменений

<table border="1">
  <tr>
    <th>Автор</th>
    <th>Версия изменений</th>
    <th>Описание</th>
    <th>Задача</th>
  </tr>
  <tr>
    <td>Савастеева А.А.</td>
    <td>1.0</td>
    <td>Draft | Исходная версия документа</td>
    <td>TASK - 1</td>
    </tr>
</table>

**Цель**: сервис предназначен для получения истории операций клиента.

**URL**: [endpoint]/api/cards/operations

**Метод**: GET

**Доступ**: авторизованная зона. Сервис вызывается с фронта.

**Входные параметры**: есть

<table border="1">
  <tr>
    <th>Параметр</th>
    <th>Тип поля</th>
    <th>Описание</th>
    <th>Обязательность</th>
  </tr>

  <tr>
    <td>cardid</td>
    <td>Array[String]</td>
    <td>Запрос истории операций по определенным картам/счетам. <br>
Если не указан, параметр current_card из конфига </td>
    <td>Нет</td>
  </tr>

  <tr>
    <td>history_operations</td>
    <td>Boolean</td>
    <td>Если true, просмотр полной истории операций <br> <br>
Если false, просмотр краткой истории операций: <br> <br>
<ul>
<li>Для endDate – параметр short_history_period из конфига <br>
<li>Для NumberOfOps – параметр short_history_count
</ul></td>
    <td>Да</td>
 </tr>

  <tr>
    <td>beginDate</td>
    <td>String</td>
    <td>Дата начала периода за который запрашивается информация <br>
Если не указан, запрашиваются операции, начиная с текущей даты
 </td>
    <td>Нет</td>
  </tr>

   <tr>
    <td>endDate</td>
    <td>String</td>
    <td>Дата окончания периода за который запрашивается информация <br>
Если не указан, параметр period
 </td>
 <td> Нет </td>
   </tr>

   <tr>
    <td>NumberOfOps</td>
    <td>Number</td>
    <td>Максимальное количество операций, которое нужно вернуть в ответ. <br>
Если не указан, в ответ отправляются все найденные операции
 </td>
 <td> Нет </td>
   </tr>

   <tr>
    <td>beginAmount</td>
    <td>Number</td>
    <td>Сумма, от которой запрашиваются совершенные транзакции. <br>
Если не указан, сумма не ограничена снизу

 </td>
    <td>Нет</td>
    </tr>

   <tr>
    <td>endAmount</td>
    <td>Number</td>
    <td>Сумма, в пределах которой запрашиваются совершенные транзакции. <br>
Если не указан, сумма не ограничена сверху

 </td>
    <td>Нет</td>
    </tr>

  <tr>
    <td>type_operation</td>
    <td>String</td>
    <td>Тип операции, история по которой запрашивается. <br>
Если не указан – параметр type
 </td>
    <td>Нет</td>
    </tr>
</table>


**Выходные параметры**: есть

<table border="1">
  <tr>
    <th>Параметр</th>
    <th>Тип поля</th>
    <th>Описание</th>
    <th>Обязательность</th>
  </tr>

  <tr>
    <td>data/cards/operations</td>
    <td>List[Object]</td>
    <td>Список операций </td>
    <td>Нет</td>
  </tr>

  <tr>
    <td>data/cards/operationDisagn</td>
    <td>String</td>
    <td>Дизайн операции (урл до картинки)</td>
    <td>Нет</td>
 </tr>

  <tr>
    <td>data/cards/operations/name</td>
    <td>String</td>
    <td>Наименование операции / мерчанта
 </td>
    <td>Да</td>
  </tr>

   <tr>
    <td>data/cards/operations/ amount</td>
    <td>Number</td>
    <td>Сумма операции в валюте транзакции
 </td>
 <td> Да </td>
   </tr>

   <tr>
    <td>data/cards/operations/currency</td>
    <td>String</td>
    <td>Валюта операции
 </td>
 <td> Да </td>
   </tr>

   <tr>
    <td>data/cards/operations/type</td>
    <td>String</td>
    <td>Тип операции, IBN - оплата услуг в ИБ, POS - POS, ATM - наличка, BAL - платный запрос баланса карты, P2P - P2P, KOM - комиссия, KAS - наличка, ACC - перевод по счету.  

 </td>
    <td>Да</td>
    </tr>

   <tr>
    <td>data/cards/operations/date_transactions</td>
    <td>DateTime</td>
    <td>Дата совершения транзакции

 </td>
    <td>Да</td>
    </tr>
</table>

## Основной сценарий (MC)
1. Сервер проверяет входные параметры запроса: 
    1.	Если параметр forceRequest= true, переходим к АС – 1 Получение карт из АБС
    0.	Иначе, сценарий продолжается.
0.	Сервер выполняет поиск карт для текущего клиента в БД в таблице card_operations:
      1.	Если операции отсутствуют, клиенту отображается текст “Операций не найдено. Выберете другую карту”.
      0.	Иначе, сценарий продолжается
0.	Сервис сортирует операции в порядке убывания дат и времени
0. Сервис формирует ответ согласно маппингу
0. Сервис возвращает ответ вызывающей системе.