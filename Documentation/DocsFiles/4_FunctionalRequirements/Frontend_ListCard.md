
#Frontend\_Список карт и детали по карте
Цель:документ описывает раздел «Список карт», и дополнительные формы, входящие в раздел.
##Макет
##(![](../../Attachments/1.png)
##(![](../../Attachments/2.png)
##Общие требования
По-умолчанию раздел должен быть доступен при наличии у клиента флага доступа flag\_cardlist == true. Иначе, раздел не отображается. Раздел доступен всем клиентам ДБО. Раздел открывается сразу после входа в ДБО и является частью «Главного экрана». Блок “Карты”
##Блок “Карты”

Для отображения раздела Frontend инициирует вызов сервиса GET api/cards/list (без параметров|запрос не параметризован)

В случае если от сервиса получена ошибка или пустой ответ, отображается экран с ошибкой. Текст сообщения «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае если получен успешный ответ, Frontend отображает форму с параметрами:

| Поле     | Описание  | 
| ------------- |------------------|
| Блок с картами| Содержит экземпляры data/cards[] ответа сервиса GET api/cards/list</p> |
|Элемент Карта   | <p>` `Действия:</p><p>1)    Реквизиты</p><p>2)    Заблокировать</p><p>3)    Тарифы</p><p>4)    История операций </p>|| 
| 1. Иконка|<p>Значение data/cards/cardDesign </p><p>Если значение не получено, отображается иконка по-умолчанию</p>|
|2. Название карты|<p>Значение data/cards/name</p><p>В поле отображается 100 символов. Если значение больше, то отображается только часть текста и троеточие.</p><p>При наведении на такую строку полный текст должен отображаться во всплывающей подсказке.</p>|
|3. Платежная система|Значение data/cards/paySystem|
|4. Номер карты|<p>Значение data/cards/maskedNumber</p><p>Отображается в формате \*XXXX, где XXXX - последние 4 цифры значения</p>|
|5. Тип карты|<p>Значение data/cards/cardtype</p><p>В случае если получено значение</p><p>·        ‘debit’ отобразить текст «Дебетовая»</p><p>·        ‘credit’ – отобразить текст «Кредитная»</p>|
|6. Баланс|<p>Значение data/cards/balance</p><p>По-умолчанию отображается зеленым цветом</p><p>В случае если значение отрицательное - отображается красным цветом</p>|
|7. Статус карты|<p>Если получено значение data/cards/status:</p><p>- ‘active’ - отобразить значение “Активна”</p><p>- ‘blocked’- отобразить значение “Заблокирована”</p><p>- ‘inactive’ - отобразить значение “Требует активации”</p>|
Под каждой картой отображаются действия, доступные с картой:

|Действие | Описание |
| ------------- |------------------|
|Реквизиты|<p>tbd</p><p>TODO</p>|
|Тарифы|tbd|
|Заблокировать|tbd|
|История операций|<p>см. Раздел История операций</p><p>Элемент представлен ссылкой.</p><p>По нажатию на ссылку появляется раскрывающийся вниз блок</p><p>Заголовок блока меняется в зависимости от раскрытия: “Показать/Скрыть историю операций”</p>

##Раздел История операций по картам

Для отображения раздела “История операций по карте” пользователю необходимо перейти по ссылке, в этом случае Frontend инициирует вызов сервиса GET data/cards/operations, где параметр запроса является id карты.

Если операций по карте не совершалось за последние 10 дней, клиенту должно отобразиться сообщение “За последние 10 дней операций по карте не совершалось”.

В случае если получен успешный ответ, Frontend отображает форму c операциями за последние 10 дней, но не больше, чем 5 записей с параметрами:



|Поле|Описание|
| ------------- |------------------|
|Блок “ История операций по карте”|<p>Содержит экземпляры data/cards/operations [] ответа сервиса  GETapi/cards/operations где параметр запроса является id карты.</p><p>Действия:</p><p>1)    Полная история операций</p>|
|Элемент Общая История операций по карте| |
| Дата операции|<p>Значение data/cards/operations/transaction\_date[]</p><p>ответа сервиса GET api/operations</p><p>Отображается в формате день и наименование месяца. </p><p>В случае если получено значение</p><p>·        ‘date == today()’ отобразить текст «Сегодня»</p><p>`           `‘date == today()-1’ отобразить текст «Вчера»</p>|
| Название операции|<p>Значение data/cards/operation/description</p><p>ответа сервиса GET api/operations</p><p>В случае если получено значение</p><p>·      IBN – отобразить “оплата услуг”</p><p>·      POS – отобразить  “выдача кредита”</p><p>·      ATM – отобразить  “выдача/прием наличных средств”</p><p>·      BAL – отобразить “запрос балансы карты“</p><p>·      KOM – отобразить “комиссия”</p><p>·      KAS – наличные </p><p>·      АСС – отобразить  “перевод по счету“</p>|
| Название мерчанта|<p>Значение data/cards/operations/mcc </p><p>Отображается согласно значению параметра  </p>|
| Валюта операции|<p>data/cards/operations/auth\_currency</p><p>Отображается согласно значению параметра  </p>|
| Cумма операции|<p>Значение data/cards/operations/transaction\_amount</p><p>По-умолчанию отображается черным цветом</p>|
|Категория операции|<p>Значение data/cards/operations/oper\_type</p><p>ответа сервиса GET cards/list/mcc</p><p>По-умолчанию отображается серым цветом.</p><p>В поле отображается 15 символов. Если значение больше, то отображается только часть текста и троеточие.</p><p>При наведении на такую строку полный текст должен отображаться во всплывающей подсказке.</p>|
| ` `Иконка операции|<p>Значение data/cards/categoryDesign ответа сервиса GET data/cards/operations/oper\_type или data/cards/operations/mcc</p><p>Если значение не получено, отображается иконка по-умолчанию</p>|


После окончания списка операций по карте клиенту доступна ссылка “Просмотр Общей Истории операций по картам”. 

|**Действие**|**Описание**|
| ------------- |------------------|
|Переход к общей Истории операций по картам|<p>см. Раздел Общая История операций</p><p>Элемент представлен ссылкой.</p><p>По нажатию на ссылку открывается новое окно, где отображаются операции за текущий месяц. </p><p> </p>|

## Раздел Общая история операций

Для отображения раздела пользователю необходимо перейти по ссылке “Общая история операций”, в этом случае Frontend инициирует вызов сервиса GET data/cards/operations (без параметров|запрос не параметризован)

Если операций по карте не совершалось за последний месяц, клиенту должно отобразиться сообщение “За текущий месяц операция не совершалось”. 

В случае если получен успешный ответ, Frontend отображает форму c операциями за последний месяц. 



|*Поле*|**Описание**|
| ------------- |------------------|
|Блок “Общая История операции”|Содержит экземпляры data/cards/operations[] ответа сервиса GET api/cards/operations|
|<p>Элемент </p><p>Фильтрация/Сортировка транзакций</p>|<p>Действия: </p><p>·      Тип Операции</p><p>·      Период</p><p>·      Карта/Счет</p><p>·      Сумма</p><p>·      Сброс</p>|
 |Тип операции|<p>Значение cards/operations/oper\_type[]</p><p>ответа сервиса GET cards/list/oper\_type</p><p>При нажатии на кнопку отображается в формате списка чекбоксов</p>|
|Период|<p>Значение data/cards/operations/begindate</p><p>Значение data/cards/operations/enddate</p><p>Отображается в формате календаря</p>|
|Карта/Счет|<p>Значение data/cards/list/cardnumber[]</p><p>ответа сервиса GET api/cards/list</p><p>Отображается в формате списка чекбоксов </p>|
|Сумма|<p>Значение data/cards/list/auth\_amount</p><p>Отображается в формате выбора параметром </p><p>-Сортировать по убыванию</p><p>-Сортировать по возрастанию</p>|
|Элемент История операций по карте| |
|Дата и совершения операции|<p>Значение data/cards/operations/begindate</p><p>Значение data/cards/operationsenddate</p><p>ответа сервиса GET api/cards/operations</p><p>Отображается в формате день и наименование месяца. </p><p>В случае если получено значение</p><p>·        ‘date == today()’ отобразить текст «Сегодня»</p>|
|Наименование карты/счета|<p>Значение data/cards/operations/card\_number</p><p>Отображается в формате последних 4 цифр карты/счета </p>|
|Название операции/мерчанта|<p>Значение data/cards/operations/nameOperations</p><p>В поле отображается 30 символов. Если значение больше, то отображается только часть текста и троеточие.</p><p>При наведении на такую строку полный текст должен отображаться во всплывающей подсказке.</p>|
|Валюта операции|Отображается согласно значению параметра data/cards/operations/currency\_auth|
|Cумма операции|<p>Значение data/cards/operations/transaction\_amount</p><p>По-умолчанию отображается черным цветом</p>|
|Категория операции|<p>Значение data/cards/operations/oper\_type</p><p>По-умолчанию отображается серым цветом.</p>|
|Иконка операции|<p>Значение data/cards/categoryDesign ответа сервиса GET api/cards/operations/category</p><p>Если значение не получено, отображается иконка по-умолчанию</p>|
|||||


Над формой отображаются действия, доступные с картой:

|**Действие**|**Описание**|
| ------------- |------------------|
|Тип операции|<p>Элемент представлен списком</p><p>При выборе параметров происходит фильтрация данных по выбранным параметрам операции. </p>|
|Период|<p>Элемент представлен календарем </p><p>При выборе параметров происходит фильтрация данных по дате совершения операций.</p>|
|Карта/Счет|<p>Элемент представлен списком</p><p>При выборе параметров происходит фильтрация данных по выбранным счетам и картам.</p>|
|Сумма|<p>Элемент представлен списком</p><p>Происходит сортировка по возрастанию, или убыванию сумм транзакций</p>|
|Сброс|Сбрасывает параметры запроса фильтрации и сортировки|

# **История изменений**

|**Автор**|**Дата изменения**|**Версия изменений**|**Описание**|**Задача**|
| ------------- |------------------|------------------|------------------|------------------|
|<p>Малышева Н.С.</p><p>Малышева Надежда Сергеевна</p>|15.09.2021 |1.0|Draft|Исходная версия документа|TASK-1|
|Рыболовлева А.В |22.09.2021|1.1|1.Добавление разделов -Краткая история операций-Общая история операций 
-Фильтрация операций по категориям
-Сортировка операций по дате, сумме|TASK-2|


